CREATE OR REPLACE PROCEDURE P_ADD_TRANSACTION (
	IN_CUST_CD IN T_MT_CUSTOMER.CD%TYPE,
	IN_EMP_CD IN T_MT_EMPLOYEE.CD%TYPE,
	IN_BK_CD     IN T_MT_BOOK.CD%TYPE,
	IN_DISC_CD IN T_MT_DISCOUNT.CD%TYPE,
	IN_TRANTYPE_CD IN T_MT_TRANTYPE.CD%TYPE,
	IN_DT_COM IN VARCHAR2
)
IS
DATE_COMMENCE DATE;
TOTAL NUMBER;
CUST_ID VARCHAR2(32);
EMP_ID VARCHAR2(32);
BK_ID VARCHAR2(32);
BK_PRICE NUMBER;
DISC_ID VARCHAR2(32);
DISC_AMT NUMBER;
TRANTYPE VARCHAR(32);
BEGIN

SELECT CUST.ID INTO CUST_ID FROM T_MT_CUSTOMER CUST WHERE CUST.CD = IN_CUST_CD;
SELECT EMP.ID INTO EMP_ID FROM T_MT_EMPLOYEE EMP WHERE EMP.CD = IN_EMP_CD;
SELECT BK.ID, BK.PRICE INTO BK_ID, BK_PRICE FROM T_MT_BOOK BK WHERE BK.CD = IN_BK_CD;
SELECT DISC.ID, DISC.AMOUNT INTO DISC_ID, DISC_AMT FROM T_MT_DISCOUNT DISC WHERE DISC.CD = IN_DISC_CD;
SELECT TRANTYPE.ID INTO TRANTYPE FROM T_MT_TRANTYPE TRANTYPE WHERE TRANTYPE.CD = IN_TRANTYPE_CD;
DATE_COMMENCE := TO_DATE(IN_DT_COM, 'DDMMYYYY');
TOTAL := (BK_PRICE * ((100-DISC_AMT)/100));

INSERT INTO T_TRANSACTION
VALUES
(
  SYS_GUID(),
  CUST_ID,
  EMP_ID,
  BK_ID,
  DISC_ID,
  TRANTYPE,
  DATE_COMMENCE,
  TOTAL
);
COMMIT;
END;
