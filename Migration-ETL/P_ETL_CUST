CREATE OR REPLACE PROCEDURE P_ETL_CUST AS
CURSOR EXT_CUR_CUST IS
SELECT EXTCUST.*,
MTCUSTOMER.ID AS MTCUSTOMERID
FROM T_EXT_CUST EXTCUST
LEFT JOIN T_MT_CUSTOMER MTCUSTOMER
ON EXTCUST.CODE = MTCUSTOMER.CD;
EXT_ROW EXT_CUR_CUST%ROWTYPE;

BEGIN

FOR EXT_ROW IN EXT_CUR_CUST LOOP

		IF EXT_ROW.MTCUSTOMERID IS NULL THEN
		INSERT INTO T_MT_CUSTOMER
		VALUES
		(
		SYS_GUID(),
		EXT_ROW.NAME,
		EXT_ROW.DOB,
		EXT_ROW.ADDRESS,
		EXT_ROW.PHONE,
		EXT_ROW.EMAIL,
		EXT_ROW.MEMBERSHIP_PERIOD,
		EXT_ROW.JOIN_DATE,
		EXT_ROW.USERNAME,
		EXT_ROW.CPASSWORD,
		EXT_ROW.CODE
		);
		ELSE
		UPDATE T_MT_CUSTOMER
		SET NAME = EXT_ROW.NAME,
			DOB = EXT_ROW.DOB,
			ADDRESS = EXT_ROW.ADDRESS,
			PHONE = EXT_ROW.PHONE,
			EMAIL = EXT_ROW.EMAIL,
			MEMBERSHIP_PERIOD = EXT_ROW.MEMBERSHIP_PERIOD,
			JOIN_DATE = EXT_ROW.JOIN_DATE,
			USERNAME = EXT_ROW.USERNAME,
			CPASSWORD = EXT_ROW.CPASSWORD
		WHERE CD = EXT_ROW.CODE;
		END IF;
                
END LOOP;
COMMIT;
END P_ETL_CUST;
