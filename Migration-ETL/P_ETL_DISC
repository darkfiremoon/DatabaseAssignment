CREATE OR REPLACE PROCEDURE P_ETL_DISC AS
CURSOR EXT_CUR_DISC IS
SELECT EXTDISC.*,
MTDISCOUNT.ID AS MTDISCOUNTID
FROM T_EXT_DISC EXTDISC
LEFT JOIN T_MT_DISCOUNT MTDISCOUNT
ON EXTDISC.CODE = MTDISCOUNT.CD;
EXT_ROW EXT_CUR_DISC%ROWTYPE;

BEGIN
FOR EXT_ROW IN EXT_CUR_DISC LOOP

	IF EXT_ROW.MTDISCOUNTID IS NULL THEN
	INSERT INTO T_MT_DISCOUNT
	VALUES
	(
	SYS_GUID(),
	EXT_ROW.TITLE,
	EXT_ROW.DISCTYPE,
	EXT_ROW.AMOUNT,
	EXT_ROW.DESCRIPTION,
	EXT_ROW.CODE
	);
	ELSE
	UPDATE T_MT_DISCOUNT
	SET TITLE = EXT_ROW.TITLE,
		DISCTYPE = EXT_ROW.DISCTYPE,
		AMOUNT = EXT_ROW.AMOUNT,
		DESCRIPTION = EXT_ROW.DESCRIPTION
	WHERE CD = EXT_ROW.CODE;
	END IF;
	
END LOOP;
COMMIT;
END P_ETL_DISC;
