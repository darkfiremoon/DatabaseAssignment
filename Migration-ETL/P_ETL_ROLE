CREATE OR REPLACE PROCEDURE P_ETL_ROLE AS
CURSOR EXT_CUR_ROLE IS
SELECT EXTROLE.*,
MTROLE.ID AS MTROLEID
FROM T_EXT_ROLE EXTROLE
LEFT JOIN T_MT_ROLE MTROLE
ON EXTROLE.CODE = MTROLE.CD;
EXT_ROW EXT_CUR_ROLE%ROWTYPE;

BEGIN

FOR EXT_ROW IN EXT_CUR_ROLE LOOP

	IF EXT_ROW.MTROLEID IS NULL THEN
	INSERT INTO T_MT_ROLE
	VALUES 
	(
	SYS_GUID(),
	EXT_ROW.ROLE,
	EXT_ROW.CODE
	);
	ELSE
	UPDATE T_MT_ROLE
	SET ROLE = EXT_ROW.ROLE
	WHERE CD = EXT_ROW.CODE;
	END IF;
END LOOP;
COMMIT;
END P_ETL_ROLE;
