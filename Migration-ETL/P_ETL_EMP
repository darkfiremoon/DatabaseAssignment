CREATE OR REPLACE PROCEDURE P_ETL_EMP AS
CURSOR EXT_CUR_EMP IS
SELECT
EMP.*,
MTROLE.ID AS ROLE_ID,
MTEMP.ID AS EMP_ID
FROM T_EXT_EMP EMP
LEFT JOIN T_MT_ROLE MTROLE
ON EMP.CODE = MTROLE.CD
LEFT JOIN T_MT_EMPLOYEE MTEMP
ON EMP.CODE = MTEMP.CD;
EXT_ROW EXT_CUR_EMP%ROWTYPE;

BEGIN
FOR EXT_ROW IN EXT_CUR_EMP LOOP

IF EXT_ROW.EMP_ID IS NULL THEN
INSERT INTO T_MT_EMPLOYEE
VALUES
(
SYS_GUID(),
EXT_ROW.NAME,
EXT_ROW.DOB,
EXT_ROW.ADDRESS,
EXT_ROW.PHONE,
EXT_ROW.EMAIL,
EXT_ROW.SALARY,
EXT_ROW.WORKING_HOURS,
EXT_ROW.USERNAME,
EXT_ROW.EPASSWORD,
EXT_ROW.ROLE_ID,
EXT_ROW.CODE
);
ELSE
UPDATE T_MT_EMPLOYEE
SET NAME = EXT_ROW.NAME,
	DOB = EXT_ROW.DOB,
	ADDRESS = EXT_ROW.ADDRESS,
	PHONE = EXT_ROW.PHONE,
	EMAIL = EXT_ROW.EMAIL,
	SALARY = EXT_ROW.SALARY,
	WORKING_HOURS = EXT_ROW.WORKING_HOURS,
	USERNAME = EXT_ROW.USERNAME,
	EPASSWORD = EXT_ROW.EPASSWORD,
	ROLE_ID = EXT_ROW.ROLE_ID
	WHERE CD = EXT_ROW.CODE;
END IF;
END LOOP;
COMMIT;
END;
